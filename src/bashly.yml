name: monk
help: Monk CLI - Command-line interface for PaaS Backend API
version: 2.12.0

environment_variables:
- name: CLI_VERBOSE
  help: Enable verbose output for all commands
- name: MONK_CLI_CONFIG_DIR
  help: "Custom directory for CLI configuration files (default: ~/.config/monk/cli)"

flags:
- long: --text
  help: Output in human-readable text format
- long: --json
  help: Output in JSON format

# Server selection is automatically handled via ~/.config/monk/servers.json
# Use 'monk server use <name>' to select target server (persistent across commands)

commands:
# Configuration initialization
- name: init
  help: Initialize configuration directory with required files
  args:
  - name: path
    required: false
    help: "Custom path for configuration directory (default: ~/.config/monk/cli)"
  flags:
  - long: --force
    help: Force reinitialization by overwriting existing config files (preserves env.json)

# Usage examples and getting started guide (recommended for new users)
- name: examples
  help: Browse interactive examples and complete workflows (start here!)
  args:
  - name: name
    required: false
    help: Example name to display (omit to list all examples)

# Current CLI status and environment overview
- name: status
  help: Show current server, tenant, user, and available schemas

# Remote server management
- name: server
  help: Remote server management
  
  commands:
  - name: add
    help: Register remote server
    args:
    - name: name
      required: true
      help: Server name
    - name: endpoint
      required: true
      help: "Server endpoint (host:port)"
    flags:
    - long: --description
      arg: description
      help: Optional server description
      
  - name: list
    help: List all servers with health status
    
  - name: current
    help: Show currently selected server
    
  - name: use
    help: "Switch to server (persistent selection) or show current server"
    args:
    - name: name
      required: false
      help: Server name to switch to (omit to show current server)
      
  - name: delete
    help: Remove server from registry
    args:
    - name: name
      required: true
      help: Server name to delete
      
  - name: ping
    help: Health check specific server (defaults to current server)
    args:
    - name: name
      required: false
      help: Server name to ping (optional, defaults to current server)
      
  - name: ping-all
    help: Health check all registered servers
    
  - name: info
    help: Show server information from API root endpoint
    args:
    - name: name
      required: false
      help: Server name to query (optional, defaults to current server)

  - name: health
    help: Check server health status from API /health endpoint
    args:
    - name: name
      required: false
      help: Server name to check (optional, defaults to current server)

# Tenant registry management
- name: tenant
  help: Tenant registry management
  
  commands:
  - name: add
    help: Register new tenant
    args:
    - name: name
      required: true
      help: Tenant identifier name
    - name: display_name
      required: true
      help: Human-readable tenant name
    flags:
    - long: --description
      arg: description
      help: Optional tenant description
      
  - name: list
    help: List all registered tenants
    flags:
    - long: --server
      arg: server
      help: Target server (defaults to current server)
    
  - name: delete
    help: Remove tenant from registry
    args:
    - name: name
      required: true
      help: Tenant name to delete
      
  - name: use
    help: Switch to tenant (persistent selection)
    args:
    - name: name
      required: true
      help: Tenant name to switch to

# Authentication and token management
- name: auth
  help: Authentication and token management
  
  commands:
  - name: list
    help: List all stored JWT tokens and sessions
    
  - name: register
    help: Register new tenant and user (creates both and stores JWT)
    args:
    - name: tenant
      required: true
      help: Tenant name to register
    - name: username
      required: true
      help: Username to register
      
  - name: login
    help: Authenticate with tenant and username
    args:
    - name: tenant
      required: true
      help: Tenant name for authentication
    - name: username
      required: true
      help: Username for authentication
      
  - name: logout
    help: Clear stored JWT token
    
  - name: status
    help: Show authentication status
    
  - name: token
    help: Display current JWT token
    
  - name: info
    help: Decode and display JWT token contents
    
  - name: ping
    help: Authenticated API health check
    flags:
    - long: --verbose
      short: -v
      help: Verbose server information
    - long: --jwt-token
      short: -j
      arg: token
      help: Include JWT token in request
      
  - name: import
    help: Import JWT token from external auth flow
    args:
    - name: tenant
      required: true
      help: Tenant name for this JWT token
    - name: username
      required: true
      help: Username for this JWT token
    flags:
    - long: --token
      short: -t
      arg: token
      help: JWT token to import (or provide via stdin)
      
  - name: expires
    help: Show JWT token expiration time
    
  - name: expired
    help: Check if JWT token is expired (exit code 0=valid, 1=expired)

# Data operations on dynamic schemas
- name: data
  help: Data operations on dynamic schemas
  
  commands:      
  - name: select
    help: Select record(s) with flexible query support
    args:
    - name: schema
      required: true
      help: Schema name
    - name: id
      required: false
      help: Record ID to retrieve (optional)
    flags:
    - long: --filter
      arg: json
      help: JSON filter for query parameters (limit, offset, order)
      
  - name: create
    help: Create record from stdin
    args:
    - name: schema
      required: true
      help: Schema name to create record in
      
  - name: update
    help: Update record(s) from stdin
    args:
    - name: schema
      required: true
      help: Schema name
    - name: id
      required: false
      help: Record ID to update (optional if ID in JSON)
      
  - name: delete
    help: Delete record(s)
    args:
    - name: schema
      required: true
      help: Schema name
    - name: id
      required: false
      help: Record ID to delete (optional if ID in JSON or using stdin)
      
  - name: export
    help: Export records to JSON files
    args:
    - name: schema
      required: true
      help: Schema name to export
    - name: dir
      required: true
      help: Directory to export to
      
  - name: import
    help: Import JSON files as records
    args:
    - name: schema
      required: true
      help: Schema name to import into
    - name: dir
      required: true
      help: Directory to import from

# Schema description and metadata management
- name: describe
  help: Schema description and metadata management
  
  commands:
  - name: select
    help: Select specific schema definition
    args:
    - name: schema
      required: true
      help: Schema name to retrieve
      
  - name: create
    help: Create new schema from JSON definition
    args:
    - name: schema
      required: true
      help: Schema name to create
      
  - name: update
    help: Update existing schema from JSON definition
    args:
    - name: schema
      required: true
      help: Schema name to update
      
  - name: delete
    help: Delete schema definition (soft delete)
    args:
    - name: schema
      required: true
      help: Schema name to delete

# Bulk operations for batch processing
- name: bulk
  help: Bulk operations for batch processing across multiple schemas
  
  commands:
  - name: raw
    help: Execute bulk operations immediately (synchronous)
    
  - name: submit
    help: Submit bulk operations for async processing (future feature)
    
  - name: status
    help: Check status of async bulk operation (future feature)
    args:
    - name: operation_id
      required: true
      help: Bulk operation ID from submit command
      
  - name: result
    help: Download results of completed bulk operation (future feature)
    args:
    - name: operation_id
      required: true
      help: Bulk operation ID from submit command
      
  - name: cancel
    help: Cancel pending bulk operation (future feature)
    args:
    - name: operation_id
      required: true
      help: Bulk operation ID to cancel

# Filesystem-like operations for API data exploration
- name: fs
  help: Filesystem-like operations for API data exploration via File API
  
  commands:
  - name: ls
    help: List directory contents with wildcard support
    args:
    - name: path
      required: true
      help: File path (e.g., /data/users/, /tenant/tenant-a/data/users/)
    flags:
    - long: --long
      short: -l
      help: Use long listing format with detailed information
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)
      
  - name: cat
    help: Display file content or record data
    args:
    - name: path
      required: true
      help: File path to file or record (e.g., /data/users/user-123.json, /tenant/tenant-a/data/users/user-123.json)
    flags:
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)
      
  - name: rm
    help: Remove files, records, or fields
    args:
    - name: path
      required: true
      help: File path to delete (e.g., /data/users/user-123, /tenant/tenant-a/data/users/user-123)
    flags:
    - long: --force
      short: -f
      help: Force permanent deletion (default is soft delete)
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)
      
  - name: stat
    help: Display detailed file/directory status and schema information
    args:
    - name: path
      required: true
      help: File path for status information (e.g., /data/users/, /tenant/tenant-a/meta/schema/)
    flags:
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)
      
  - name: cp
    help: Copy records between schemas or duplicate records
    args:
    - name: source
      required: true
      help: Source path (e.g., /data/users/123.json, /data/users/)
    - name: destination
      required: true
      help: Destination path (e.g., /data/users/456.json, /data/backup/users/)
    flags:
    - long: --recursive
      short: -r
      help: Copy directory contents recursively
    - long: --force
      short: -f
      help: Force overwrite and allow cross-tenant operations
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)

# Advanced search with filter DSL
- name: find
  help: Advanced search with enterprise Filter DSL via JSON input
  args:
  - name: schema
    required: true
    help: Schema to search
  flags:
  - long: --head
    short: -H
    help: Return only first record from results
  - long: --tail
    short: -T
    help: Return only last record from results

# Project management for simplified tenant creation and management
- name: project
  help: Project management for simplified tenant creation and workflow
  
  commands:
  - name: init
    help: Initialize new project with automatic tenant creation
    args:
    - name: name
      required: true
      help: Project name (will be used as tenant name)
    flags:
    - long: --description
      arg: description
      help: Optional project description
    - long: --tags
      arg: tags
      help: Comma-separated project tags
    - long: --create-user
      arg: username
      help: Create initial user with specified username
    - long: --auto-login
      help: Automatically login as created user
    - long: --host
      arg: hostname
      help: "Database host (default: localhost)"
      
  - name: list
    help: List all projects (tenants)
    flags:
    - long: --include-trashed
      help: Include soft-deleted projects
    - long: --include-deleted
      help: Include hard-deleted projects
      
  - name: show
    help: Show project details
    alias: info
    args:
    - name: name
      required: true
      help: Project name
      
  - name: use
    help: Switch to project context
    args:
    - name: name
      required: true
      help: Project name to switch to
      
  - name: delete
    help: Delete project (soft delete by default)
    args:
    - name: name
      required: true
      help: Project name to delete
    flags:
    - long: --force
      help: Skip confirmation
    - long: --permanent
      help: Permanent deletion (hard delete)

# API Documentation viewer
- name: docs
  help: View API documentation from remote server
  args:
  - name: area
    required: true
    help: Documentation area to view (e.g., auth, data, meta, find, bulk, file, acls, root)

# Administrative operations (development only)
- name: root
  help: Administrative operations for tenant management (localhost development only)
  
  commands:
  - name: tenant
    help: Tenant management operations
    
    commands:
    - name: list
      help: List all tenants
      alias: ls
      flags:
      - long: --include-trashed
        help: Include soft-deleted tenants
      - long: --include-deleted
        help: Include hard-deleted tenants
        
    - name: create
      help: Create new tenant
      alias: add
      args:
      - name: name
        required: true
        help: Tenant name
      flags:
      - long: --host
        arg: hostname
        help: "Database host (default: localhost)"
      - long: --force
        help: Force creation even if exists
        
    - name: show
      help: Show tenant details
      alias: info
      args:
      - name: name
        required: true
        help: Tenant name
        
    - name: trash
      help: Soft delete tenant (set trashed_at)
      args:
      - name: name
        required: true
        help: Tenant name
        
    - name: restore
      help: Restore soft deleted tenant
      args:
      - name: name
        required: true
        help: Tenant name
        
    - name: delete
      help: Hard delete tenant (permanent)
      alias: purge
      args:
      - name: name
        required: true
        help: Tenant name
      flags:
      - long: --force
        help: Skip confirmation
        
    - name: health
      help: Check tenant database health
      args:
      - name: name
        required: true
        help: Tenant name



