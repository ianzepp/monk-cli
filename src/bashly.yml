name: monk
help: |
  Monk CLI - Command-line interface for PaaS Backend API

  Getting started:
    monk examples getting-started    # Browse interactive examples
    monk docs data                   # View API documentation for the Data API

  Usage examples:
    monk status                      # Show current server/tenant/user
    monk data list users             # List all users
    monk examples                    # List all available examples

  Output format flags (must come BEFORE command):
    monk --format json status        # Get status in JSON format
    monk --format markdown data list users   # Get user list in markdown table
    monk --unwrap status             # Remove envelope, return data object only
    monk --select id,name data list users    # Extract specific fields

  For detailed help on a command, run: monk <command> --help
version: 2.30.0

environment_variables:
- name: CLI_VERBOSE
  help: Enable verbose output for all commands
- name: MONK_CLI_CONFIG_DIR
  help: "Custom directory for CLI configuration files (default: ~/.config/monk/cli)"

flags:
- long: --format
  arg: format
  allowed: [json, toon, yaml, toml, csv, markdown, morse, qr, brainfuck, msgpack]
  help: Server-side response format (json/toon/yaml/toml/csv/markdown/msgpack/etc) via ?format= parameter
- long: --unwrap
  help: Remove response envelope, return data object only via ?unwrap parameter
- long: --select
  arg: fields
  help: Extract specific fields (comma-separated) via ?select= parameter (e.g., id,name or user.email)
- long: --encrypt
  arg: type
  allowed: [pgp]
  help: Encrypt response using specified method (pgp) via ?encrypt= parameter

# Server selection is automatically handled via ~/.config/monk/servers.json
# Use 'monk config server use <name>' to select target server (persistent across commands)

commands:
# Configuration initialization
- name: init
  help: Initialize configuration directory with required files
  group: Configuration & Utilities
  args:
  - name: path
    required: false
    help: "Custom path for configuration directory (default: ~/.config/monk/cli)"
  flags:
  - long: --force
    help: Force reinitialization by overwriting existing config files (preserves env.json)

# Quick context switching
- name: use
  help: Switch server context (and optionally tenant)
  group: Configuration & Utilities
  args:
  - name: server
    required: true
    help: Server name to switch to (use '.' for current server)
  - name: tenant
    required: false
    help: Optional tenant name to switch to

# Usage examples and getting started guide (recommended for new users)
- name: examples
  help: Browse interactive examples and complete workflows (start here!)
  group: Configuration & Utilities
  args:
  - name: name
    required: false
    help: Example name to display (omit to list all examples)

# Current CLI status and environment overview
- name: status
  help: Show current server, tenant, user, and available schemas
  group: Configuration & Utilities

# Progressive health checks
- name: ping
  help: Run progressive health checks on current connection and API endpoints
  group: Configuration & Utilities

# Direct API testing with curl wrapper
- name: curl
  help: Make authenticated API requests using current server and credentials
  group: Configuration & Utilities
  args:
  - name: method
    required: true
    help: HTTP method (GET, POST, PUT, DELETE, etc.)
  - name: path
    required: true
    help: API endpoint path (e.g., /api/file/list, /api/auth/ping)
  flags:
  - long: --data
    short: -d
    arg: json
    help: JSON data to send (alternative to stdin)
  - long: --raw
    short: -r
    help: Output raw response without pretty-printing

# Configuration management
- name: config
  help: Configuration management for servers and tenants
  group: Configuration & Utilities

  commands:
  # Remote server management
  - name: server
    help: Remote server management

    commands:
    - name: add
      help: Register remote server
      args:
      - name: name
        required: true
        help: Server name
      - name: endpoint
        required: true
        help: "Server endpoint (host:port)"
      flags:
      - long: --description
        arg: description
        help: Optional server description

    - name: list
      help: List all servers with health status

    - name: current
      help: Show currently selected server

    - name: use
      help: "Switch to server (persistent selection) or show current server"
      args:
      - name: name
        required: false
        help: Server name to switch to (omit to show current server)

    - name: delete
      help: Remove server from registry
      args:
      - name: name
        required: true
        help: Server name to delete

    - name: ping
      help: Health check specific server (defaults to current server)
      args:
      - name: name
        required: false
        help: Server name to ping (optional, defaults to current server)

    - name: ping-all
      help: Health check all registered servers

    - name: info
      help: Show server information from API root endpoint
      args:
      - name: name
        required: false
        help: Server name to query (optional, defaults to current server)

    - name: health
      help: Check server health status from API /health endpoint
      args:
      - name: name
        required: false
        help: Server name to check (optional, defaults to current server)

  # Tenant registry management
  - name: tenant
    help: Tenant registry management

    commands:
    - name: add
      help: Register new tenant
      args:
      - name: name
        required: true
        help: Tenant identifier name
      - name: display_name
        required: true
        help: Human-readable tenant name
      flags:
      - long: --description
        arg: description
        help: Optional tenant description

    - name: list
      help: List all registered tenants
      flags:
      - long: --server
        arg: server
        help: Target server (defaults to current server)

    - name: delete
      help: Remove tenant from registry
      args:
      - name: name
        required: true
        help: Tenant name to delete

    - name: use
      help: Switch to tenant (persistent selection)
      args:
      - name: name
        required: true
        help: Tenant name to switch to

# Authentication and token management
- name: auth
  help: Authentication and token management
  group: API Endpoints

  commands:
  - name: list
    help: List all stored JWT tokens and sessions

  - name: register
    help: Register new tenant and user (creates both and stores JWT)
    args:
    - name: tenant
      required: true
      help: Tenant name to register
    - name: username
      required: false
      help: Username to register (defaults to 'root' in personal mode, required in enterprise mode)
    flags:
    - long: --template
      arg: template
      help: Template name to use (defaults to 'empty', use 'monk auth templates' to list available)
    - long: --database
      arg: database
      help: Custom database name (personal mode only)
    - long: --description
      arg: description
      help: Human-readable description of the tenant

  - name: login
    help: Authenticate with tenant and username
    args:
    - name: tenant
      required: true
      help: Tenant name for authentication
    - name: username
      required: true
      help: Username for authentication

  - name: logout
    help: Clear stored JWT token

  - name: status
    help: Show authentication status

  - name: token
    help: Display current JWT token

  - name: info
    help: Decode and display JWT token contents

  - name: ping
    help: Authenticated API health check
    flags:
    - long: --verbose
      short: -v
      help: Verbose server information
    - long: --jwt-token
      short: -j
      arg: token
      help: Include JWT token in request

  - name: import
    help: Import JWT token from external auth flow
    args:
    - name: tenant
      required: true
      help: Tenant name for this JWT token
    - name: username
      required: true
      help: Username for this JWT token
    flags:
    - long: --token
      short: -t
      arg: token
      help: JWT token to import (or provide via stdin)

  - name: expires
    help: Show JWT token expiration time

  - name: expired
    help: Check if JWT token is expired (exit code 0=valid, 1=expired)

  - name: tenants
    help: List available tenants (personal mode only)

  - name: templates
    help: List available templates (personal mode only)

  - name: sudo
    help: Request sudo token for dangerous operations (15min validity)
    flags:
    - long: --reason
      arg: reason
      help: Reason for privilege escalation (for audit trail)

# Data operations on dynamic schemas
- name: data
  help: Data operations on dynamic schemas
  group: API Endpoints

  commands:
  - name: list
    help: List record(s) with flexible query support
    args:
    - name: schema
      required: true
      help: Schema name
    - name: id
      required: false
      help: Record ID to retrieve (optional)
    flags:
    - long: --filter
      arg: json
      help: JSON filter for query parameters (limit, offset, order)

  - name: create
    help: Create record from stdin
    args:
    - name: schema
      required: true
      help: Schema name to create record in

  - name: update
    help: Update record(s) from stdin
    args:
    - name: schema
      required: true
      help: Schema name
    - name: id
      required: false
      help: Record ID to update (optional if ID in JSON)

  - name: delete
    help: Delete record(s)
    args:
    - name: schema
      required: true
      help: Schema name
    - name: id
      required: false
      help: Record ID to delete (optional if ID in JSON or using stdin)

  - name: export
    help: Export records to JSON files
    args:
    - name: schema
      required: true
      help: Schema name to export
    - name: dir
      required: true
      help: Directory to export to

  - name: import
    help: Import JSON files as records
    args:
    - name: schema
      required: true
      help: Schema name to import into
    - name: dir
      required: true
      help: Directory to import from

# Schema description and metadata management
- name: describe
  help: Schema description and metadata management
  group: API Endpoints

  commands:
  - name: list
    help: List all available schema names in the current tenant

  - name: select
    help: Select specific schema definition
    args:
    - name: schema
      required: true
      help: Schema name to retrieve

  - name: create
    help: Create new schema from JSON definition
    args:
    - name: schema
      required: true
      help: Schema name to create

  - name: update
    help: Update existing schema from JSON definition
    args:
    - name: schema
      required: true
      help: Schema name to update

  - name: delete
    help: Delete schema definition (soft delete)
    args:
    - name: schema
      required: true
      help: Schema name to delete

# Bulk operations for batch processing
- name: bulk
  help: Execute multiple operations across schemas in a single transaction via JSON input
  group: API Endpoints

# Filesystem-like operations for API data exploration
- name: fs
  help: Filesystem-like operations for API data exploration via File API
  group: Configuration & Utilities

  commands:
  - name: ls
    help: List directory contents with wildcard support
    args:
    - name: path
      required: true
      help: File path (e.g., /data/users/, /tenant/tenant-a/data/users/)
    flags:
    - long: --long
      short: -l
      help: Use long listing format with detailed information
    - long: --all
      short: -a
      help: Show hidden entries (system fields like access_*, created_at, etc.)
    - long: --sort
      short: -S
      arg: field
      allowed: [name, size, time, type]
      default: name
      help: "Sort entries by field (name, size, time, or type)"
    - long: --reverse
      short: -r
      help: Reverse sort order (descending instead of ascending)
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)

  - name: cat
    help: Display file content or record data
    args:
    - name: path
      required: true
      help: File path to file or record (e.g., /data/users/user-123.json, /tenant/tenant-a/data/users/user-123.json)
    flags:
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)
    - long: --format
      short: -f
      arg: format
      allowed: [json, raw]
      default: json
      help: "Output format: json (structured) or raw (string content)"
    - long: --offset
      short: -o
      arg: bytes
      help: Byte offset to start reading from (for partial reads)
    - long: --max-bytes
      short: -m
      arg: bytes
      help: Maximum bytes to read (for limiting large outputs)

  - name: rm
    help: Remove files, records, or fields
    args:
    - name: path
      required: true
      help: File path to delete (e.g., /data/users/user-123, /tenant/tenant-a/data/users/user-123)
    flags:
    - long: --force
      short: -f
      help: Force permanent deletion (default is soft delete)
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)

  - name: stat
    help: Display detailed file/directory status and schema information
    args:
    - name: path
      required: true
      help: File path for status information (e.g., /data/users/, /tenant/tenant-a/meta/schema/)
    flags:
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)

  - name: cp
    help: Copy records between schemas or duplicate records
    args:
    - name: source
      required: true
      help: Source path (e.g., /data/users/123.json, /data/users/)
    - name: destination
      required: true
      help: Destination path (e.g., /data/users/456.json, /data/backup/users/)
    flags:
    - long: --recursive
      short: -r
      help: Copy directory contents recursively
    - long: --force
      short: -f
      help: Force overwrite and allow cross-tenant operations
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)

  - name: size
    help: Calculate storage footprint for files or directories
    args:
    - name: path
      required: true
      help: File path to calculate size (e.g., /data/users/user-123.json)
    flags:
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)

  - name: mtime
    help: Retrieve modified timestamps for files or directories
    args:
    - name: path
      required: true
      help: File path to check modified time (e.g., /data/users/user-123.json)
    flags:
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)

  - name: find
    help: Find files/directories with content filtering (Unix find-like)
    args:
    - name: path
      required: true
      help: Starting path for search (e.g., /data/users/, /data/)
    flags:
    - long: --where
      short: -w
      arg: condition
      repeatable: true
      help: Filter by content (key=value or JSON WHERE clause)
    - long: --type
      short: -T
      arg: type
      allowed: [f, d, l]
      help: "Filter by type (f=file, d=directory, l=link)"
    - long: --name
      short: -n
      arg: pattern
      help: "Filter by name pattern (wildcards: * ?)"
    - long: --maxdepth
      arg: depth
      help: Maximum directory depth to search
    - long: --print0
      help: Null-separated output (for xargs -0)
    - long: --tenant
      short: -t
      arg: tenant
      help: Target tenant (tenant-name or server:tenant-name)

# Advanced search with filter DSL
- name: find
  help: Advanced search with enterprise Filter DSL via JSON input
  group: API Endpoints
  args:
  - name: schema
    required: true
    help: Schema to search
  flags:
  - long: --head
    short: -H
    help: Return only first record from results
  - long: --tail
    short: -T
    help: Return only last record from results

# Aggregation with grouping and statistics
- name: aggregate
  help: Perform aggregation queries with GROUP BY and statistics via JSON input
  group: API Endpoints
  args:
  - name: schema
    required: true
    help: Schema to aggregate

# Get record metadata without fetching full data
- name: stat
  help: Get record metadata without fetching full record data
  group: API Endpoints
  args:
  - name: schema
    required: true
    help: Schema name
  - name: id
    required: true
    help: Record ID to retrieve metadata for

# Data synchronization between tenants and servers
- name: sync
  help: Synchronize data between tenants, servers, or local directories
  group: Configuration & Utilities

  commands:
  - name: pull
    help: Pull data from remote tenant to local directory
    args:
    - name: source
      required: true
      help: "Source endpoint (tenant:schema or server:tenant:schema)"
    - name: directory
      required: true
      help: Local directory path to save data
    flags:
    - long: --filter
      short: -f
      arg: json
      help: Filter DSL for selective sync
    - long: --overwrite
      help: Overwrite existing files in directory

  - name: push
    help: Push data from local directory to remote tenant
    args:
    - name: directory
      required: true
      help: Local directory path containing JSON files
    - name: destination
      required: true
      help: "Destination endpoint (tenant:schema or server:tenant:schema)"
    flags:
    - long: --dry-run
      help: Show what would be synced without making changes

  - name: diff
    help: Show differences between two endpoints
    args:
    - name: source
      required: true
      help: "Source endpoint (tenant:schema, server:tenant:schema, or directory)"
    - name: destination
      required: true
      help: "Destination endpoint (tenant:schema, server:tenant:schema, or directory)"
    flags:
    - long: --format
      arg: format
      allowed: [summary, json]
      default: summary
      help: Output format (summary or json)
    - long: --output
      short: -o
      arg: file
      help: Save diff to patch file
    - long: --filter
      short: -f
      arg: json
      help: Filter DSL to limit comparison scope

  - name: copy
    help: Direct copy between two remote tenants (streaming)
    args:
    - name: source
      required: true
      help: "Source endpoint (tenant:schema or server:tenant:schema)"
    - name: destination
      required: true
      help: "Destination endpoint (tenant:schema or server:tenant:schema)"
    flags:
    - long: --filter
      short: -f
      arg: json
      help: Filter DSL for selective sync
    - long: --dry-run
      help: Show what would be synced without making changes
    - long: --strategy
      arg: strategy
      allowed: [replace, merge]
      default: replace
      help: Sync strategy (replace all or merge/upsert)

  - name: patch
    help: Apply a previously generated patch file
    args:
    - name: patch_file
      required: true
      help: Patch file from sync diff --output
    - name: destination
      required: true
      help: "Destination endpoint (tenant:schema or server:tenant:schema)"
    flags:
    - long: --dry-run
      help: Show what would be changed without applying
    - long: --reverse
      short: -R
      help: Apply patch in reverse (undo)

# API Documentation viewer
- name: docs
  help: View API documentation from remote server
  group: Configuration & Utilities
  args:
  - name: area
    required: false
    help: Documentation area to view (omit to list all available areas)

# Package management operations
- name: package
  help: Package management operations for schema and data distribution
  group: Configuration & Utilities

  commands:
  - name: init
    help: Initialize a new package definition
    args:
    - name: name
      required: false
      help: Package name (defaults to current directory name)
    flags:
    - long: --description
      arg: description
      help: Package description

  - name: verify
    help: Verify package integrity and dependencies
    args:
    - name: package_file
      required: false
      help: Package file to verify (defaults to package.json in current directory)

  - name: install
    help: Install a package to the current tenant
    args:
    - name: package_file
      required: true
      help: Package file or URL to install
    flags:
    - long: --force
      help: Force installation even if package already exists
    - long: --dry-run
      help: Show what would be installed without making changes

  - name: uninstall
    help: Uninstall a package from the current tenant
    args:
    - name: package_name
      required: true
      help: Package name to uninstall
    flags:
    - long: --force
      help: Force uninstall without confirmation
    - long: --keep-data
      help: Keep data when uninstalling (remove schema only)

  - name: describe
    help: Manage schema definitions in the package

    commands:
    - name: add
      help: Add a schema definition from current tenant to package
      args:
      - name: schema
        required: true
        help: Schema name to add from current tenant
      flags:
      - long: --force
        help: Overwrite if schema file already exists

# Administrative operations requiring sudo token
- name: sudo
  help: User management operations requiring sudo token (requires root access)
  group: API Endpoints

  commands:
  - name: users
    help: User management operations

    commands:
    - name: list
      help: List all users in current tenant
      alias: ls

    - name: create
      help: Create new user
      alias: add
      flags:
      - long: --name
        arg: name
        required: true
        help: Display name for the user
      - long: --auth
        arg: auth
        required: true
        help: Authentication identifier (username/email)
      - long: --access
        arg: access
        required: true
        help: "Access level: deny, read, edit, full, or root"

    - name: show
      help: Show user details
      alias: info
      args:
      - name: id
        required: true
        help: User ID (UUID)

    - name: update
      help: Update existing user
      args:
      - name: id
        required: true
        help: User ID (UUID)
      flags:
      - long: --name
        arg: name
        help: Display name
      - long: --access
        arg: access
        help: "Access level: deny, read, edit, full, or root"

    - name: delete
      help: Delete user (soft delete)
      alias: rm
      args:
      - name: id
        required: true
        help: User ID (UUID)
      flags:
      - long: --force
        help: Skip confirmation

  - name: templates
    help: Template management operations

    commands:
    - name: list
      help: List all available templates
      alias: ls

    - name: show
      help: Show template details
      args:
      - name: name
        required: true
        help: Template name

  - name: sandboxes
    help: Sandbox environment management

    commands:
    - name: list
      help: List all sandboxes in current tenant
      alias: ls

    - name: create
      help: Create new sandbox from template
      flags:
      - long: --template
        arg: template
        required: true
        help: Template name to clone from
      - long: --description
        arg: description
        help: Purpose of sandbox
      - long: --expires-in-days
        arg: days
        help: Days until expiration (default 7)

    - name: show
      help: Show sandbox details
      args:
      - name: name
        required: true
        help: Sandbox name

    - name: delete
      help: Delete sandbox and its database
      alias: rm
      args:
      - name: name
        required: true
        help: Sandbox name to delete
      flags:
      - long: --force
        help: Skip confirmation

    - name: extend
      help: Extend sandbox expiration date
      args:
      - name: name
        required: true
        help: Sandbox name
      flags:
      - long: --days
        arg: days
        required: true
        help: Number of days to extend

  - name: snapshots
    help: Snapshot management for backups

    commands:
    - name: list
      help: List all snapshots for current tenant
      alias: ls

    - name: create
      help: Create new snapshot (async operation)
      flags:
      - long: --name
        arg: name
        help: Unique snapshot name (auto-generated if omitted)
      - long: --description
        arg: description
        help: Purpose of snapshot
      - long: --type
        arg: type
        allowed: [manual, auto, pre_migration, scheduled]
        help: Snapshot type
      - long: --expires-in-days
        arg: days
        help: Days until expiration

    - name: show
      help: Show snapshot details and check status
      args:
      - name: name
        required: true
        help: Snapshot name

    - name: delete
      help: Delete snapshot and its database
      alias: rm
      args:
      - name: name
        required: true
        help: Snapshot name to delete
      flags:
      - long: --force
        help: Skip confirmation
